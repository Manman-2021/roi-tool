<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¾¾äººROIä¸æ”¶å…¥ç²¾ç®—å™¨</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><rect x=%220%22 y=%220%22 width=%22128%22 height=%22128%22 rx=%2224%22 ry=%2224%22 fill=%22%23fe2c55%22/><path d=%22M10 0 C4.5 0 0 4.5 0 10 L0 70 C0 75.5 4.5 80 10 80 L70 80 C75.5 80 80 75.5 80 70 L80 10 C80 4.5 75.5 0 70 0 Z M72 70 C72 71.1 71.1 72 70 72 L10 72 C8.9 72 8 71.1 8 70 L8 10 C8 8.9 8.9 8 10 8 L70 8 C71.1 8 72 8.9 72 10 Z%22 transform=%22translate(24, 24)%22 fill=%22%23ffffff%22/></svg>">

    <style>
        /* å…¨å±€æ ·å¼è®¾ç½® */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Microsoft YaHei', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: #333;
        }

        /* æ¨¡æ‹Ÿæ‰‹æœº/Appçš„ä¸»å®¹å™¨ */
        .app-container {
            width: 100%;
            max-width: 400px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œä¿æŒAppæ„Ÿè§‰ */
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            height: fit-content;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        header {
            background: #fe2c55;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            padding: 15px;
        }

        /* æ¿å—æ ·å¼ */
        .section {
            background: white;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }

        /* æ¿å—æ ‡é¢˜ */
        h3 {
            margin: 0 0 15px 0;
            font-size: 15px;
            color: #333;
            border-left: 4px solid #fe2c55;
            padding-left: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            background: #e8f5e9;
            color: #2e7d32;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: normal;
        }

        /* è¾“å…¥è¡Œå¸ƒå±€ */
        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .row label {
            font-size: 14px;
            color: #555;
            flex: 1;
        }
        .row input {
            width: 90px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            text-align: right;
            font-size: 15px;
            outline: none;
            transition: 0.2s;
            background: #fafafa;
        }
        .row input:focus {
            border-color: #fe2c55;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(254, 44, 85, 0.1);
        }
        .unit {
            font-size: 13px;
            color: #999;
            margin-left: 8px;
            width: 15px;
        }

        /* ç‰¹æ®Šè¾“å…¥æ¡†ï¼šæˆæœ¬ */
        .cost-input {
            border-color: #ffcccc !important;
            color: #d32f2f;
            background-color: #fffafa !important;
        }

        /* ç»“æœæ˜¾ç¤ºåŒº */
        .result-box {
            background: #f8f9fa;
            border: 1px dashed #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        .result-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .result-value {
            font-size: 26px;
            font-weight: 800;
            color: #fe2c55;
            font-family: 'Arial', sans-serif;
        }
        .sub-result {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* åˆ†å‰²çº¿ */
        hr {
            border: 0;
            border-top: 1px solid #eee;
            margin: 10px 0 15px 0;
        }

        /* åº•éƒ¨ç‰ˆæƒ/æç¤º */
        footer {
            text-align: center;
            font-size: 12px;
            color: #bbb;
            margin-top: 20px;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <header>ğŸ“Š è¾¾äººä½£é‡‘ç²¾ç®—å™¨ Webç‰ˆ</header>

        <div class="content">
            <div class="section">
                <h3>ğŸ” å•å“æŠ•æµæµ‹ç®— <span class="badge">æ¿å—ä¸€</span></h3>
                
                <div class="row"><label>1. å•†å“ä»·æ ¼</label><input type="number" id="p1_price" placeholder="0"><span class="unit">å…ƒ</span></div>
                <div class="row"><label>2. ä½£é‡‘ç‡</label><input type="number" id="p1_rate" placeholder="20"><span class="unit">%</span></div>
                <hr>
                <div class="row"><label>3. å‘è´§å‰é€€æ¬¾ç‡</label><input type="number" id="p1_refund_pre" placeholder="5"><span class="unit">%</span></div>
                <div class="row"><label>4. å‘è´§åé€€è´§ç‡</label><input type="number" id="p1_refund_post" placeholder="30"><span class="unit">%</span></div>
                <div class="row"><label>5. ä½£é‡‘æç°è´¹ç‡</label><input type="number" id="p1_tax" value="10"><span class="unit">%</span></div>

                <div class="result-box">
                    <div class="result-title">æŠ•æµä¿æœ¬ ROI (ç›ˆäºçº¿)</div>
                    <div class="result-value" id="res_roi">0.00</div>
                    <div class="sub-result">æ¯å–ä¸€å•å‡€èµšä½£é‡‘: <span id="res_profit_per_order">Â¥0.00</span></div>
                </div>
            </div>

            <div class="section">
                <h3>ğŸ’° å•åœºå‡€åˆ©æ¶¦å¤ç›˜ <span class="badge">æ¿å—äºŒ</span></h3>

                <div class="row"><label>1. æœ¬åœºç›´æ’­ GMV</label><input type="number" id="p2_gmv" placeholder="0"><span class="unit">å…ƒ</span></div>
                <div class="row"><label>2. æ€»é€€æ¬¾/é€€è´§ç‡</label><input type="number" id="p2_refund_total" placeholder="è‡ªåŠ¨" disabled style="background:#eee; color:#999;"><span class="unit">%</span></div>
                
                <div class="row"><label>â†³ å‘è´§å‰é€€æ¬¾ç‡</label><input type="number" id="p2_refund_pre" placeholder="10"><span class="unit">%</span></div>
                <div class="row"><label>â†³ å‘è´§åé€€è´§ç‡</label><input type="number" id="p2_refund_post" placeholder="30"><span class="unit">%</span></div>
                <hr>
                <div class="row"><label>4. è®¡ä½£é‡‘é¢ä½£é‡‘ç‡</label><input type="number" id="p2_rate" placeholder="20"><span class="unit">%</span></div>
                <div class="row"><label>5. æç°è´¹ç‡</label><input type="number" id="p2_tax" value="10"><span class="unit">%</span></div>
                
                <div class="row"><label style="color:#d32f2f; font-weight:bold;">6. æœ¬åœºæŠ•æµè´¹ç”¨</label><input type="number" id="p2_ad_cost" placeholder="0" class="cost-input"><span class="unit">å…ƒ</span></div>

                <div class="result-box" style="border-color: #00b85c; background: #f0f9f4;">
                    <div class="result-title">å»é™¤æŠ•æµåÂ·å‡€åˆ©æ¶¦</div>
                    <div class="result-value" id="res_income" style="color: #00b85c;">Â¥0.00</div>
                    <div class="sub-result">çº¯ä½£é‡‘æ”¶å…¥: <span id="res_gross_income">Â¥0</span></div>
                </div>
            </div>

            <footer>æ•°æ®è‡ªåŠ¨ä¿å­˜ Â· ä»…ä¾›æœ¬åœ°ä½¿ç”¨</footer>
        </div>
    </div>

    <script>
        // DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–æ‰€æœ‰è¾“å…¥æ¡†
            const inputs = document.querySelectorAll('input');
            
            // 1. ä» localStorage æ¢å¤ä¹‹å‰è¾“å…¥çš„æ•°æ®
            inputs.forEach(input => {
                const savedValue = localStorage.getItem('roi_tool_' + input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
                
                // 2. ç»‘å®šç›‘å¬ï¼šåªè¦è¾“å…¥å°±è®¡ç®—å¹¶ä¿å­˜
                input.addEventListener('input', () => {
                    localStorage.setItem('roi_tool_' + input.id, input.value); // è‡ªåŠ¨ä¿å­˜
                    calculateAll();
                });
            });

            // åˆå§‹åŒ–è®¡ç®—ä¸€æ¬¡
            calculateAll();
        });

        // æ€»è®¡ç®—å‡½æ•°
        function calculateAll() {
            calculateSection1();
            calculateSection2();
        }

        // --- æ¿å—ä¸€è®¡ç®—ï¼šæŠ•æµç›ˆäºçº¿ ---
        function calculateSection1() {
            const price = parseFloat(document.getElementById('p1_price').value) || 0;
            const rate = parseFloat(document.getElementById('p1_rate').value) || 0;
            const refundPre = parseFloat(document.getElementById('p1_refund_pre').value) || 0;
            const refundPost = parseFloat(document.getElementById('p1_refund_post').value) || 0;
            const tax = parseFloat(document.getElementById('p1_tax').value) || 0;

            // æœ‰æ•ˆç³»æ•° = (1 - å‘è´§å‰é€€ - å‘è´§åé€€)
            const validPercent = (1 - (refundPre/100) - (refundPost/100));
            // æç°åˆ°æ‰‹ç³»æ•°
            const taxPercent = (1 - (tax/100));
            // ä½£é‡‘ç³»æ•°
            const commissionPercent = (rate/100);

            // è¾¾äººæœ€ç»ˆæ¯1å…ƒé”€å”®é¢çš„å‡€åˆ°æ‰‹æ¯”ä¾‹
            const finalRatio = validPercent * commissionPercent * taxPercent;

            // è®¡ç®— ROI
            let roi = 0;
            if (finalRatio > 0) {
                roi = 1 / finalRatio;
            }

            // è®¡ç®—æ¯å•å‡€èµš
            const profitPerOrder = price * finalRatio;

            // æ˜¾ç¤º ROI
            const roiEl = document.getElementById('res_roi');
            if (roi > 0 && roi < 100) {
                roiEl.innerText = roi.toFixed(2);
            } else if (roi >= 100) {
                roiEl.innerText = "99.9+";
            } else {
                roiEl.innerText = "0.00";
            }

            // æ˜¾ç¤ºæ¯å•å‡€èµš
            document.getElementById('res_profit_per_order').innerText = 'Â¥' + profitPerOrder.toFixed(2);
        }

        // --- æ¿å—äºŒè®¡ç®—ï¼šå•åœºå‡€åˆ©æ¶¦ ---
        function calculateSection2() {
            const gmv = parseFloat(document.getElementById('p2_gmv').value) || 0;
            const refundPre = parseFloat(document.getElementById('p2_refund_pre').value) || 0;
            const refundPost = parseFloat(document.getElementById('p2_refund_post').value) || 0;
            const rate = parseFloat(document.getElementById('p2_rate').value) || 0;
            const tax = parseFloat(document.getElementById('p2_tax').value) || 0;
            const adCost = parseFloat(document.getElementById('p2_ad_cost').value) || 0;

            // æ›´æ–°æ€»é€€æ¬¾ç‡
            document.getElementById('p2_refund_total').value = (refundPre + refundPost).toFixed(1);

            // å®é™…ç»“ç®—GMV
            const validPercent = (1 - (refundPre/100) - (refundPost/100));
            const realGmv = gmv * validPercent; 
            
            const commissionPercent = (rate/100);
            const taxPercent = (1 - (tax/100));
            
            // çº¯ä½£é‡‘æ”¶å…¥ (æœªæ‰£æŠ•æµ)
            const grossIncome = realGmv * commissionPercent * taxPercent;

            // æœ€ç»ˆå‡€åˆ©æ¶¦ (æ‰£é™¤æŠ•æµ)
            const netProfit = grossIncome - adCost;

            // æ˜¾ç¤º
            const incomeEl = document.getElementById('res_income');
            incomeEl.innerText = 'Â¥' + netProfit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            document.getElementById('res_gross_income').innerText = 'Â¥' + grossIncome.toLocaleString('en-US', {maximumFractionDigits: 0});

            // å˜è‰²é€»è¾‘
            if (netProfit < 0) {
                incomeEl.style.color = '#d32f2f'; // äºæŸçº¢
            } else {
                incomeEl.style.color = '#00b85c'; // ç›ˆåˆ©ç»¿
            }
        }
    </script>
</body>
</html>